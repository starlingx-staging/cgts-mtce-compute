%global subdir "mtce-compute/cgts-mtce-compute-1.0"
%global SOURCE1 goenabled
%global SOURCE2 e_nova-init
%global SOURCE3 nova-cleanup
%global SOURCE4 nova-startup

%global SOURCE11 nova-cleanup.conf
%global SOURCE12 nova-compute.conf
%global SOURCE14 libvirtd.conf

%global SOURCE21 nova-goenabled.sh
%global SOURCE22 virt-support-goenabled.sh

%global SOURCE31 goenabled-compute.service
%global SOURCE32 e_nova-init.service

%global _sysconfdir '/usr/local/etc'
%global local_etc_pmond      %{_sysconfdir}/pmon.d
%global local_etc_goenabledd %{_sysconfdir}/goenabled.d
%global local_etc_nova       %{_sysconfdir}/nova

%global _unitdir "/usr/lib/systemd/system"

# Compute-Only Init Scripts (source group x)
install -m 755 -p -D %{subdir}/scripts/%{SOURCE1} %{buildroot}/%{_sysconfdir}/init.d/goenabledCompute
install -m 755 -p -D %{subdir}/scripts/%{SOURCE2} %{buildroot}/%{_sysconfdir}/init.d/e_nova-init
install -m 755 -p -D %{subdir}/scripts/%{SOURCE3} %{buildroot}/%{_sysconfdir}/init.d/nova-cleanup
install -m 755 -p -D %{subdir}/scripts/%{SOURCE4} %{buildroot}/%{_sysconfdir}/init.d/nova-startup

# Compute-Only Process Monitor Config files (source group 1x)
install -m 755 -d                %{buildroot}%{local_etc_pmond}
install -m 755 -d                %{buildroot}%{local_etc_nova}
install -m 644 -p -D %{subdir}/scripts/%{SOURCE11} %{buildroot}%{local_etc_nova}/nova-cleanup.conf
install -m 644 -p -D %{subdir}/scripts/%{SOURCE12} %{buildroot}%{local_etc_nova}/nova-compute.conf
install -m 644 -p -D %{subdir}/scripts/%{SOURCE14} %{buildroot}%{local_etc_pmond}/libvirtd.conf

# Compute-Only Go Enabled Test (source group 2x)
install -m 755 -d                %{buildroot}%{local_etc_goenabledd}
install -m 755 -p -D %{subdir}/scripts/%{SOURCE21} %{buildroot}%{local_etc_goenabledd}/nova-goenabled.sh
install -m 755 -p -D %{subdir}/scripts/%{SOURCE22} %{buildroot}%{local_etc_goenabledd}/virt-support-goenabled.sh

# Install to systemd (source group 3x)
install -m 644 -p -D %{subdir}/scripts/%{SOURCE31} %{buildroot}%{_unitdir}/goenabled-compute.service
install -m 644 -p -D %{subdir}/scripts/%{SOURCE32} %{buildroot}%{_unitdir}/e_nova-init.service

%clean
